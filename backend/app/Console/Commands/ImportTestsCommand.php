<?php

namespace App\Console\Commands;

use App\Models\Category;
use App\Models\Test;
use Illuminate\Console\Command;

class ImportTestsCommand extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'tests:import';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Import psychological tests from predefined data structure';

    /**
     * Execute the console command.
     */
    public function handle(): int
    {
        $this->info('Starting test import...');

        $topics = $this->getTopicsData();

        $createdCategories = 0;
        $createdTests = 0;
        $skippedCategories = 0;
        $skippedTests = 0;

        foreach ($topics as $topic) {
            // Create or get category
            $category = Category::firstOrCreate(
                ['name' => $topic['title']],
                ['description' => null]
            );

            if ($category->wasRecentlyCreated) {
                $createdCategories++;
                $this->info("Created category: {$category->name}");
            } else {
                $skippedCategories++;
                $this->warn("Category already exists: {$category->name}");
            }

            // Create tests for this category
            foreach ($topic['tests'] as $testData) {
                // Check if test already exists
                $existingTest = Test::where('category_id', $category->id)
                    ->where('title', $testData['title'])
                    ->first();

                if ($existingTest) {
                    $skippedTests++;
                    $this->warn("  Test already exists: {$testData['title']}");
                    continue;
                }

                // Format questions for Likert scale (1-5)
                $questions = array_map(function ($questionText) {
                    return ['text' => $questionText];
                }, $testData['questions']);

                // Create the test
                Test::create([
                    'category_id' => $category->id,
                    'title' => $testData['title'],
                    'description' => null,
                    'test_type' => 'likert',
                    'questions' => $questions,
                    'time_limit_minutes' => null,
                    'scoring_logic' => null,
                    'result_interpretation' => null,
                ]);

                $createdTests++;
                $questionCount = count($questions);
                $this->info("  Created test: {$testData['title']} ({$questionCount} questions)");
            }
        }

        $this->newLine();
        $this->info('Import completed!');
        $this->table(
            ['Type', 'Created', 'Skipped'],
            [
                ['Categories', $createdCategories, $skippedCategories],
                ['Tests', $createdTests, $skippedTests],
            ]
        );

        return Command::SUCCESS;
    }

    /**
     * Get the topics data structure
     *
     * @return array
     */
    private function getTopicsData(): array
    {
        return [
            [
                'id' => 0,
                'title' => 'Делегирование полномочий и принятие решений',
                'tests' => [
                    [
                        'id' => 1,
                        'title' => 'Делегирование — базовый',
                        'questions' => [
                            'Я ясно формулирую задачу перед её делегированием.',
                            'Я предоставляю сотруднику достаточно полномочий для выполнения задачи.',
                            'Я контролирую результат без излишнего вмешательства.',
                            'Я даю обратную связь после выполнения задания.',
                            'Я выбираю подходящих людей для конкретных задач.',
                            'Я оцениваю риски прежде чем делегировать ответственность.',
                            'Я устанавливаю реалистичные сроки при делегировании.',
                            'Я доверяю исполнителям и позволяю им находить собственные решения.',
                            'Я обеспечиваю доступ к ресурсам, необходимым для выполнения задачи.',
                            'Я учитываю нагрузку сотрудников при распределении задач.',
                            'Я даю возможность сотруднику принять решение в рамках своей зоны ответственности.',
                        ],
                    ],
                    [
                        'id' => 2,
                        'title' => 'Делегирование — продвинутый',
                        'questions' => [
                            'Я делегирую задачи, чтобы развивать сотрудников.',
                            'Я объясняю, почему задача важна и как она влияет на результат.',
                            'Я назначаю четкие критерии результата.',
                            'Я корректирую полномочия в зависимости от результатов.',
                            'Я использую делегирование для повышения мотивации.',
                            'Я понимаю, какие задачи нужно делегировать в первую очередь.',
                            'Я согласовываю риски и ответственность с исполнителем.',
                            'Я контролирую прогресс без микроменеджмента.',
                            'Я даю возможность сотрудникам экспериментировать в рамках задачи.',
                            'Я учитываю индивидуальные способности при делегировании.',
                            'Я помогаю сотрудникам учиться на ошибках после делегирования.',
                        ],
                    ],
                    [
                        'id' => 3,
                        'title' => 'Делегирование — кейсы',
                        'questions' => [
                            'Я использую делегирование в условиях жесткого дедлайна.',
                            'Я перераспределяю задачи при изменении приоритетов.',
                            'Я оцениваю готовность сотрудника к новым обязанностям.',
                            'Я делегирую полномочия и сохраняю ответственность за результат.',
                            'Я корректирую план, если исполнитель сталкивается с проблемами.',
                            'Я фиксирую соглашения о том, кто за что отвечает.',
                            'Я умею делегировать не только рутину, но и сложные задачи.',
                            'Я даю ресурсы и контакты для выполнения задачи.',
                            'Я обсуждаю критерии успеха до начала работы.',
                            'Я поощряю инициативу при выполнении делегированных задач.',
                            'Я анализирую успешные и неуспешные кейсы делегирования.',
                        ],
                    ],
                ],
            ],
            [
                'id' => 1,
                'title' => 'Отбор персонала',
                'tests' => [
                    [
                        'id' => 1,
                        'title' => 'Отбор — основы',
                        'questions' => [
                            'Я использую четкие критерии при найме.',
                            'Я формулирую профиль кандидата заранее.',
                            'Я проверяю резюме на соответствие ключевым требованиям.',
                            'Я использую поведенческие вопросы на собеседовании.',
                            'Я оцениваю мотивацию кандидата для роли.',
                            'Я проверяю рекомендации при необходимости.',
                            'Я учитываю корпоративную культуру при подборе.',
                            'Я даю кандидатам ясную информацию о вакансии.',
                            'Я оцениваю потенциал кандидата на развитие.',
                            'Я использую структурированные интервью для сравнения кандидатов.',
                            'Я анализирую ошибки прошлых наймов и корректирую процесс.',
                        ],
                    ],
                    [
                        'id' => 2,
                        'title' => 'Отбор — интервью',
                        'questions' => [
                            'Я готовлю вопросы под конкретную роль.',
                            'Я оцениваю не только навыки, но и поведение кандидата.',
                            'Я использую задания/тесты для проверки навыков.',
                            'Я стараюсь создать комфортную атмосферу для кандидата.',
                            'Я фиксирую впечатления по стандартизированной форме.',
                            'Я даю кандидатам возможность задать вопросы о компании.',
                            'Я анализирую несоответствия в ответах кандидатов.',
                            'Я привлекаю коллег для оценки кандидата.',
                            'Я учитываю долгосрочную перспективу при найме.',
                            'Я проверяю релевантные кейсы из опыта кандидата.',
                            'Я делаю выводы на основании объективных данных.',
                        ],
                    ],
                    [
                        'id' => 3,
                        'title' => 'Отбор — адаптация',
                        'questions' => [
                            'Я включаю план адаптации при найме.',
                            'Я заранее согласовываю ожидания с кандидатом.',
                            'Я назначаю наставника для нового сотрудника.',
                            'Я оцениваю прогресс сотрудника в первые месяцы.',
                            'Я даю обратную связь на раннем этапе работы.',
                            'Я корректирую обязанности в зависимости от результатов.',
                            'Я обсуждаю карьерные ожидания с новым сотрудником.',
                            'Я даю ресурсы и обучение для быстрого старта.',
                            'Я оцениваю интеграцию сотрудника в команду.',
                            'Я использую результаты подбора для улучшения процесса найма.',
                            'Я анализирую причины отказов кандидатов на этапе оффера.',
                        ],
                    ],
                ],
            ],
            [
                'id' => 2,
                'title' => 'Адаптация сотрудников',
                'tests' => [
                    [
                        'id' => 1,
                        'title' => 'Адаптация — вводная',
                        'questions' => [
                            'У нового сотрудника есть четкий план на первые 30 дней.',
                            'Наставник помогает в решении повседневных вопросов.',
                            'Сотрудник понимает корпоративные ценности с первого дня.',
                            'Я провожу регулярные встречи в первые месяцы.',
                            'Сотруднику доступны необходимые инструменты и доступы.',
                            'Я отслеживаю прогресс по ключевым задачам новичка.',
                            'Я собираю обратную связь у новичка о процессе адаптации.',
                            'Я корректирую план адаптации при необходимости.',
                            'Команда вовлекается в процесс интеграции новичка.',
                            'Я оцениваю трудности новичка и предлагаю помощь.',
                            'Есть четкие критерии успешной адаптации.',
                        ],
                    ],
                    [
                        'id' => 2,
                        'title' => 'Адаптация — наставничество',
                        'questions' => [
                            'Наставник получает инструкцию о своей роли.',
                            'Наставник знакомит новичка с процессами компании.',
                            'Наставник ставит небольшие, выполнимые задачи.',
                            'Наставник регулярно обсуждает прогресс с новичком.',
                            'Наставник помогает наладить контакты внутри команды.',
                            'Наставник оценивает не только задачи, но и поведение.',
                            'Наставник получает обратную связь о процессе.',
                            'Есть формальная система назначения наставников.',
                            'Наставник поощряет самостоятельность новичка.',
                            'Наставник фиксирует ключевые точки обучения новичка.',
                            'Наставник участвует в оценке итогов адаптации.',
                        ],
                    ],
                    [
                        'id' => 3,
                        'title' => 'Адаптация — метрики',
                        'questions' => [
                            'Я использую KPI для оценки адаптации.',
                            'Я отслеживаю вовлеченность нового сотрудника.',
                            'Я оцениваю скорость вхождения в рабочие процессы.',
                            'Я фиксирую количество ошибок на старте работы.',
                            'Я собираю обратную связь от команды о новичке.',
                            'Я оцениваю качество выполненных задач новичка.',
                            'Я смотрю на retention в первые 3 месяца.',
                            'Я анализирую, что тормозит быструю адаптацию.',
                            'Я корректирую обучение по результатам метрик.',
                            'Я сравниваю показатели новых сотрудников между собой.',
                            'Я использую данные адаптации для улучшения найма.',
                        ],
                    ],
                ],
            ],
            [
                'id' => 3,
                'title' => 'Мотивация персонала',
                'tests' => [
                    [
                        'id' => 1,
                        'title' => 'Мотивация — базовая',
                        'questions' => [
                            'Я регулярно интересуюсь мотивацией сотрудников.',
                            'Я понимаю, что мотивирует каждого члена команды.',
                            'Я даю своевременную и конструктивную обратную связь.',
                            'Я поощряю достижения и усилия сотрудников.',
                            'Я обсуждаю карьерные цели со своими подчинёнными.',
                            'Я стараюсь давать интересные и сложные задачи.',
                            'Я учитываю личные потребности при распределении задач.',
                            'Я поощряю инициативу и ответственность.',
                            'Я использую нематериальные стимулы вместе с материальными.',
                            'Я открыто обсуждаю вопросы неудовлетворённости.',
                            'Я поддерживаю баланс между работой и личной жизнью.',
                        ],
                    ],
                    [
                        'id' => 2,
                        'title' => 'Мотивация — программы',
                        'questions' => [
                            'В компании есть программы поощрения достижений.',
                            'Программы мотивации привязаны к результатам.',
                            'Я вовлекаю сотрудников в разработку мотивационных схем.',
                            'У нас есть прозрачные критерии получения бонусов.',
                            'Я анализирую эффективность мотивационных программ.',
                            'Я использую короткие признания для повышения мотивации.',
                            'Я стараюсь учитывать индивидуальные предпочтения сотрудников.',
                            'Программы мотивации регулярно пересматриваются.',
                            'Я измеряю влияние программ на retention сотрудников.',
                            'Программы поддержки помогают в стрессовые периоды.',
                            'Я отслеживаю справедливость распределения поощрений.',
                        ],
                    ],
                    [
                        'id' => 3,
                        'title' => 'Мотивация — лидерство',
                        'questions' => [
                            'Лидер показывает своим примером желаемое поведение.',
                            'Лидер умеет вдохновлять команду на результат.',
                            'Лидер слышит и учитывает мнение команды.',
                            'Лидер формулирует ясную цель и миссию команды.',
                            'Лидер поддерживает сотрудников в сложных задачах.',
                            'Лидер поощряет обучение и развитие.',
                            'Лидер устраняет барьеры для работы команды.',
                            'Лидер справедливо распределяет награды и признание.',
                            'Лидер мотивирует не только словами, но и действиями.',
                            'Лидер умеет показывать признание публично.',
                            'Лидер помогает найти смысл в работе сотрудников.',
                        ],
                    ],
                ],
            ],
            [
                'id' => 4,
                'title' => 'Системы компенсации и стимулирования персонала',
                'tests' => [
                    [
                        'id' => 1,
                        'title' => 'Компенсации — основы',
                        'questions' => [
                            'Зарплата соответствует рыночным условиям.',
                            'Компенсация прозрачна и понятна сотрудникам.',
                            'Есть гибкие варианты компенсации (бенефиты).',
                            'Компенсация связанна с результатами работы.',
                            'Система компенсаций регулярно пересматривается.',
                            'Есть программы для долгосрочной мотивации (опционы, бонусы).',
                            'Компенсация учитывает вклад каждого сотрудника.',
                            'Сотрудники понимают структуру компенсации.',
                            'Справедливость в оплате труда поддерживается руководством.',
                            'Есть механизм определения повышения оплаты.',
                            'Компенсация сочетается с развитием и обучением.',
                        ],
                    ],
                    [
                        'id' => 2,
                        'title' => 'Стимулы — краткосрочные',
                        'questions' => [
                            'Краткосрочные бонусы работают как мотивационный инструмент.',
                            'Бонусы связаны с достижимыми целями.',
                            'Бонусы выдаются вовремя и прозрачно.',
                            'Есть нематериальные признания (грамоты, похвала).',
                            'Быстрые поощрения помогают при кратких проектах.',
                            'Система стимулов понятна каждому сотруднику.',
                            'Есть гибкие правила для распределения бонусов.',
                            'Стимулы не создают конкуренции в ущерб команде.',
                            'Стимулы учитывают вклад команды, а не только отдельных лиц.',
                            'Стимулы корректируются в зависимости от результата.',
                            'Стимулы влияют на быстроту выполнения задач.',
                        ],
                    ],
                    [
                        'id' => 3,
                        'title' => 'Стратегия компенсаций',
                        'questions' => [
                            'Система компенсаций поддерживает стратегию компании.',
                            'Компенсации помогают удерживать ключевых сотрудников.',
                            'Есть долгосрочные планы развития компенсаций.',
                            'Компенсации связаны с KPI и результатами отдела.',
                            'Система гибко реагирует на изменения рынка.',
                            'Компенсации учитывают внутреннюю справедливость.',
                            'Есть прозрачные правила для повышения и продвижения.',
                            'Компенсации интегрированы с программами обучения.',
                            'Руководство регулярно анализирует эффективность системы.',
                            'Система стимулирования соответствует бюджету компании.',
                            'Компенсации учитывают различия в ролях и ответственности.',
                        ],
                    ],
                ],
            ],
            [
                'id' => 5,
                'title' => 'Управление проблемными сотрудниками',
                'tests' => [
                    [
                        'id' => 1,
                        'title' => 'Проблемы — выявление',
                        'questions' => [
                            'Я оцениваю причины снижения продуктивности.',
                            'Я привлекаю HR при системных проблемах.',
                            'Я корректирую задачи при временных сложностях сотрудника.',
                            'Я обеспечиваю ясность ожиданий и санкций.',
                            'Я отслеживаю прогресс после вмешательства.',
                        ],
                    ],
                    [
                        'id' => 2,
                        'title' => 'Проблемы — корректировка',
                        'questions' => [
                            'Я обсуждаю конкретные примеры проблемного поведения.',
                            'Я ставлю понятные и измеримые цели для улучшения.',
                            'Я поддерживаю сотрудника на пути изменений.',
                            'Я фиксирую договоренности и сроки улучшений.',
                            'Я организую обучение для закрытия пробелов.',
                            'Я корректирую нагрузку при восстановлении результата.',
                            'Я использую постепенные санкции при отсутствии прогресса.',
                            'Я взаимодействую с HR для юридически корректных решений.',
                            'Я анализирую, можно ли сохранить сотрудника в роли.',
                            'Я документирую все этапы корректирующих действий.',
                            'Я оцениваю эффект после внедренных мер.',
                        ],
                    ],
                    [
                        'id' => 3,
                        'title' => 'Проблемы — превенция',
                        'questions' => [
                            'Я работаю над предотвращением выгорания в команде.',
                            'Я регулярно собираю обратную связь о рабочей нагрузке.',
                            'Я мониторю баланс задач между сотрудниками.',
                            'Я развиваю культуру открытого обсуждения проблем.',
                            'Я провожу регулярные 1:1 встречи для выявления рисков.',
                            'Я обучаю лидеров работать с трудными ситуациями.',
                            'Я делаю профилактические проверки процессов и ролей.',
                            'Я оцениваю факторы, влияющие на демотивацию.',
                            'Я предлагаю меры поддержки при личных трудностях сотрудников.',
                            'Я создаю безопасную среду для обсуждения обратной связи.',
                            'Я анализирую причины проблем и корректирую процессы.',
                        ],
                    ],
                ],
            ],
            [
                'id' => 6,
                'title' => 'Создание эффективной команды',
                'tests' => [
                    [
                        'id' => 1,
                        'title' => 'Команда — основы',
                        'questions' => [
                            'У команды есть общая цель и понимание задач.',
                            'Роли и ответственности внутри команды ясны.',
                            'Команда регулярно обсуждает прогресс по задачам.',
                            'Команда умеет эффективно коммуницировать.',
                            'Члены команды доверяют друг другу.',
                            'Я поощряю совместное принятие решений.',
                            'Конфликты решаются конструктивно.',
                            'Команда делится знаниями и опытом.',
                            'Я поддерживаю инициативы команды.',
                            'Команда достигает поставленных целей своевременно.',
                            'Команда гибко реагирует на изменения.',
                        ],
                    ],
                    [
                        'id' => 2,
                        'title' => 'Команда — развитие',
                        'questions' => [
                            'Я организую обучение для команды как единого целого.',
                            'Я создаю возможности для перекрестного обучения.',
                            'Я провожу ретроспективы и извлекаю уроки.',
                            'Я поощряю эксперименты внутри команды.',
                            'Я отслеживаю развитие ключевых компетенций.',
                            'Я обеспечиваю поддержку при внедрении изменений.',
                            'Я помогаю формировать командную культуру.',
                            'Я отслеживаю KPI команды и корректирую цели.',
                            'Я инвестирую в развитие потенциальных лидеров команды.',
                            'Я анализирую взаимодействие команды с другими подразделениями.',
                            'Я стимулирую инициативы, повышающие эффективность.',
                        ],
                    ],
                    [
                        'id' => 3,
                        'title' => 'Команда — динамика',
                        'questions' => [
                            'Команда быстро адаптируется к новым задачам.',
                            'Команда умеет распределять роли при кризисе.',
                            'Команда сохраняет мотивацию при нагрузке.',
                            'В команде есть пространство для выражения мнений.',
                            'Члены команды понимают ценность разнообразия.',
                            'Команда умеет переводить конфликт в конструктив.',
                            'Лидер команды поддерживает развитие группы.',
                            'Команда четко фиксирует договоренности.',
                            'Команда регулярно пересматривает способы работы.',
                            'Команда стремится к общей эффективности, а не индивидуальному успеху.',
                            'Команда делит ответственность за ошибки и успехи.',
                        ],
                    ],
                ],
            ],
            [
                'id' => 7,
                'title' => 'Развитие персонала',
                'tests' => [
                    [
                        'id' => 1,
                        'title' => 'Развитие — планирование',
                        'questions' => [
                            'У сотрудников есть персональные планы развития.',
                            'Планы развития учитывают бизнес-цели компании.',
                            'Сотрудники вовлечены в создание своих планов.',
                            'Есть бюджет на обучение и развитие.',
                            'Я регулярно обсуждаю прогресс по плану развития.',
                            'Планы развития привязаны к карьерным траекториям.',
                            'Есть метрики для оценки эффективности обучения.',
                            'Сотрудникам доступны программы менторства.',
                            'Компания поощряет внутренние перемещения для развития.',
                            'Развитие связано с реальными проектами и задачами.',
                            'Есть прозрачный процесс повышения квалификации.',
                        ],
                    ],
                    [
                        'id' => 2,
                        'title' => 'Развитие — обучение',
                        'questions' => [
                            'У нас есть разнообразные форматы обучения.',
                            'Обучение практическое и ориентировано на результат.',
                            'Я оцениваю эффект обучения по результатам работы.',
                            'Сотрудники получают доступ к внешним курсам при необходимости.',
                            'Мы поощряем обмен знаниями внутри компании.',
                            'Обучение связано с текущими проектами.',
                            'Есть система признания за развитие компетенций.',
                            'Обучение регулярно обновляется под новые требования.',
                            'Мы отслеживаем вовлеченность в программы обучения.',
                            'Есть инструменты для самообучения сотрудников.',
                            'Обучение помогает закрывать реальные бизнес-проблемы.',
                        ],
                    ],
                    [
                        'id' => 3,
                        'title' => 'Развитие — оценка',
                        'questions' => [
                            'Мы регулярно проводим оценки компетенций.',
                            'Оценка помогает формировать планы развития.',
                            'Оценивание основано на объективных критериях.',
                            'Мы используем обратную связь 360 градусов.',
                            'Результаты оценки интегрированы в HR-процессы.',
                            'Мы разбираем результаты оценки с сотрудником лично.',
                            'Оценка направлена на развитие, а не только на контроль.',
                            'Мы корректируем планы развития на основе оценок.',
                            'Оценка помогает выявлять потенциал для ротации.',
                            'Мы даем ресурсы на развитие после оценки.',
                            'Оценка помогает формировать справедливые решения по росту.',
                        ],
                    ],
                ],
            ],
        ];
    }
}

